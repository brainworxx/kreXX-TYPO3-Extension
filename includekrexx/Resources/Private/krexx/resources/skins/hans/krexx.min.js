/*! kreXX: Krumo eXXtended | (C) 2014-2015 Brainworxx GmbH | http://opensource.org/licenses/LGPL-2.1 */
(function(a){function f(){}document.addEventListener("DOMContentLoaded",function(){f.onDocumentReady()});f.onDocumentReady=function(){a.draXX(".kwrapper",".kheadnote",function(){for(var a=document.querySelectorAll(".search-wrapper"),b=0;b<a.length;b++)a[b].style.position="fixed"},function(){for(var a=document.querySelectorAll(".search-wrapper"),b=0;b<a.length;b++)a[b].style.position="absolute"});a.addEvent(".kwrapper .kheadnote-wrapper .kclose, .kwrapper .kfatal-headnote .kclose","click",f.close);
a.addEvent(".kwrapper .kexpand","click",f.toggle);a.addEvent(".ktool-tabs .ktab:not(.ksearchbutton)","click",f.switchTab);a.addEvent(".kwrapper .keditable select, .kwrapper .keditable input:not(.ksearchfield)","change",a.setSetting);a.addEvent(".kwrapper .resetbutton","click",a.resetSetting);a.addEvent(".kwrapper .kcopyFrom","click",f.copyFrom);a.addEvent(".kwrapper .ksearchbutton, .kwrapper .ksearch .kclose","click",f.displaySearch);a.addEvent(".kwrapper .ksearchnow","click",f.performSearch);a.addEvent(".kwrapper .ksearchfield",
"keyup",f.searchfieldReturn);a.addEvent(".kwrapper .kcollapse-me","click",f.collapse);a.addEvent(".kwrapper .kgencode","click",f.generateCode);"file:"===window.location.protocol&&f.disableForms()};f.copyFrom=function(c){c.preventDefault();c.stopPropagation();var b;c=a.getDataset(this,"domid");if(b=document.querySelector("#"+c)){var d=b.previousElementSibling;this.parentNode.insertBefore(b.cloneNode(!0),this.nextSibling);d=d.cloneNode(!0);this.parentNode.insertBefore(d,this.nextSibling);d.addEventListener("click",
f.toggle);d.querySelector(".kgencode").addEventListener("click",f.generateCode);d.querySelector(".kcollapse-me").addEventListener("click",f.collapse);var g=d.nextElementSibling.querySelectorAll(".kexpand");for(b=0;b<g.length;b++)g[b].addEventListener("click",f.toggle);g=d.nextElementSibling.querySelectorAll(".kcollapse-me");for(b=0;b<g.length;b++)g[b].addEventListener("click",f.collapse);g=d.nextElementSibling.querySelectorAll(".kgencode");for(b=0;b<g.length;b++)g[b].addEventListener("click",f.generateCode);
g=d.nextElementSibling.querySelectorAll(".kwrapper .kcopyFrom");for(b=0;b<g.length;b++)g[b].addEventListener("click",f.copyFrom);a.findInDomlistByClass(d.children,"kname").innerHTML=a.findInDomlistByClass(this.children,"kname").innerHTML;g=d.nextElementSibling.getElementsByTagName("*");for(b=0;b<g.length;b++)g[b].removeAttribute("id");d.nextElementSibling.removeAttribute("id");a.setDataset(d.parentNode,"domid",c);this.parentNode.removeChild(this)}};f.collapse=function(c){c.preventDefault();c.stopPropagation();
c=c.target;var b=a.getParents(c,".kwrapper")[0];a.removeClass(b.querySelectorAll(".kfilterroot"),"kfilterroot");a.removeClass(b.querySelectorAll(".krootline"),"krootline");a.removeClass(b.querySelectorAll(".ktopline"),"ktopline");a.hasClass(c,"kcollapsed")?a.removeClass(".kcollapsed","kcollapsed"):(a.addClass(a.getParents(c,"div.kbg-wrapper > ul"),"kfilterroot"),a.addClass(a.getParents(c,"ul.knode, li.kchild"),"krootline"),a.addClass([a.getParents(c,".krootline")[0]],"ktopline"),a.removeClass(b.querySelectorAll(".kcollapsed"),
"kcollapsed"),a.addClass([c],"kcollapsed"))};var e=[];f.performSearch=function(c){function b(){a.removeClass(".ksearch-found-highlight","ksearch-found-highlight");e[g]=[];e[g][d]=[];e[g][d].data=[];for(var b=h.querySelectorAll("li span, li div.kpreview"),c=0;c<b.length;++c)-1<b[c].textContent.indexOf(d)&&(a.toggleClass(b[c],"ksearch-found-highlight"),e[g][d].data.push(b[c]));e[g][d].pointer=-1}c.preventDefault();c.stopPropagation();var d=this.parentNode.querySelector(".ksearchfield").value;if(3<d.length){var g=
a.getDataset(this,"instance");c=a.getDataset(this,"direction");for(var h=document.querySelector("#"+g+" .kbg-wrapper"),l=h.querySelectorAll(".kcollapsed"),k=0;k<l.length;k++)a.trigger(l[k],"click");"undefined"!=typeof e[g]?"undefined"==typeof e[g][d]&&b():b();"forward"==c?e[g][d].pointer++:e[g][d].pointer--;"undefined"==typeof e[g][d].data[e[g][d].pointer]&&(e[g][d].pointer="forward"==c?0:e[g][d].data.length-1);this.parentNode.querySelector(".ksearch-state").textContent=e[g][d].pointer+" / "+(e[g][d].data.length-
1);"undefined"!==typeof e[g][d].data[e[g][d].pointer]&&f.jumpTo(e[g][d].data[e[g][d].pointer])}else this.parentNode.querySelector(".ksearch-state").textContent="<- must be bigger than 3 characters"};f.displaySearch=function(c){c.preventDefault();c.stopPropagation();c=a.getDataset(this,"instance");var b=document.querySelector("#search-"+c);document.querySelector("#"+c+" .ksearchbutton");a.hasClass(b,"hidden")?(a.toggleClass(b,"hidden"),b.querySelector(".ksearchfield").focus(),b.style.position="fixed"):
(a.toggleClass(b,"hidden"),a.removeClass(".ksearch-found-highlight","ksearch-found-highlight"),b.style.position="fixed",e=[])};f.toggle=function(c){c.stopPropagation();a.toggleClass(this,"kopened");a.toggleClass(this.nextElementSibling,"khidden")};f.jumpTo=function(c){var b=a.getParents(c,".knest"),d,g;a.removeClass(b,"khidden");for(var e=0;e<b.length;e++)a.addClass([b[e].previousElementSibling],"kopened");a.removeClass(".highlight-jumpto","highlight-jumpto");a.addClass([c],"highlight-jumpto");d=
document.querySelectorAll(".kfatalwrapper-outer");0==d.length?(d=document.querySelectorAll("html"),g=c.getBoundingClientRect().top+d[0].scrollTop-50):g=c.getBoundingClientRect().top-d[0].getBoundingClientRect().top+d[0].scrollTop-50;if(0<d.length){var f;f=d[0].scrollTop<g?10:-10;clearInterval(m);var k=d[0].scrollTop,m=setInterval(function(){d[0].scrollTop+=f;(Math.abs(d[0].scrollTop-g)<=Math.abs(f)||d[0].scrollTop==k)&&clearInterval(m);k=d[0].scrollTop},1)}};f.close=function(c){c.preventDefault();
c.stopPropagation();c=a.getDataset(c.target,"instance");var b=document.querySelector("#"+c),d=1,g=setInterval(function(){0>d?(clearInterval(g),b.parentNode.removeChild(b)):(d-=.1,b.style.opacity=d)},20)};f.disableForms=function(){for(var a=document.querySelectorAll(".kwrapper .keditable input, .kwrapper .keditable select"),b=0;b<a.length;b++)a[b].disabled=!0};f.generateCode=function(c){c.preventDefault();c.stopPropagation();for(var b=c.target.nextElementSibling,d="",g,e=a.getParents(c.target,"li.kchild")[0];e;){g=
a.getDataset(e,"domid");c=a.getDataset(e,"source");"undefined"!==typeof c&&". . ."==c&&"undefined"!==typeof g&&(e=document.querySelector("#"+g).parentNode,c=a.getDataset(e,"source"));if("undefined"!==typeof c)if(". . ."==c){d="// Value is either protected or private.<br /> // Sorry . . ";break}else d=c+d;e=a.getParents(e,"li.kchild")[0]}b.innerHTML='<div class="kcode-inner">'+d+";</div>";"none"==b.style.display?(b.style.display="",a.selectText(b)):b.style.display="none"};f.switchTab=function(c){c.preventDefault();
c.stopPropagation();c=a.getDataset(this.parentNode,"instance");var b=a.getDataset(this,"what");a.removeClass("#"+c+" .kactive:not(.ksearchbutton)","kactive");this.classList?this.classList.add("kactive"):this.className+=" kactive";a.addClass("#"+c+" .kpayload","khidden");a.removeClass("#"+c+" ."+b,"khidden")};f.setPayloadMaxHeight=function(){var a=Math.round(.6*Math.max(document.documentElement.clientHeight,window.innerHeight||0));if(0<a)for(var b=document.querySelectorAll(".krela-wrapper .kpayload"),
d=0;d<b.length;d++)b[d].style.maxHeight=a+"px"};f.checkSeachInViewport=function(a){a=document.querySelector(".kfatalwrapper-outer .search-wrapper");a.style.position="";a.style.top="";0>a.getBoundingClientRect().top&&(a.style.position="fixed",a.style.top="0px")};f.searchfieldReturn=function(c){c.preventDefault();c.stopPropagation();13==c.which&&a.trigger(this.parentNode.querySelectorAll(".ksearchnow")[1],"click")}})(kreXXdomTools);